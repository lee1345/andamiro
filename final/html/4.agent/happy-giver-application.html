<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>행복나르미 신청</title>
    <link href="https://fonts.googleapis.com/css2?family=Gowun+Dodum&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: "Gowun Dodum", sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f3f4f6; /* 부드러운 배경색 */
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        h2 {
            color: #31708f; /* 제목 색상 */
            margin-bottom: 20px;
        }

        .form-container, .output-container {
            width: 90%;
            max-width: 800px; /* 최대 너비 제한 */
            margin: 20px 0;
            padding: 20px;
            background: white; /* 카드 같은 느낌 */
            border-radius: 10px; /* 둥근 모서리 */
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1); /* 그림자 효과 */
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }

        th {
            background-color: #e0f7fa; /* 테이블 헤더 색상 */
            color: #31708f;
            text-align: center;
            font-size: 12pt;
            border-bottom: 1px solid #31708f; /* 아래 테두리 */
            border-top: 1px solid #31708f; /* 아래 테두리 */
        }

        td {
            padding: 0px;
            text-align: center;
            border: 1px solid #cfd8dc; /* 테두리 색상 */
            border-bottom: 1px solid #31708f; /* 아래 테두리 */
            border-top: 1px solid #31708f; /* 위 테두리 */
            border-right: none;
            border-left: none;
        }
        
        input, textarea, select {
            font-family: "Gowun Dodum", sans-serif;
            width: calc(100% - 20px);
            padding: 10px;
            margin: 5px 0;
            border: 1px solid #cfd8dc; /* 입력 필드 테두리 */
            border-radius: 5px; /* 둥근 모서리 */
            font-size: 10pt;
            transition: border-color 0.3s;
        
        }input, textarea{
            border: none;
        }
        textarea{
            height: 200px;
            resize: none;
        }

        input:focus, textarea:focus, select:focus {
            border-color: #31708f; /* 포커스 시 테두리 색상 변화 */
            outline: none; /* 기본 아웃라인 제거 */
        }

        button {
            background-color: #336e8b; /* 버튼 색상 */
            color: white;
            border: none;
            border-radius: 5px;
            padding: 10px 20px;
            cursor: pointer;
            font-size: 14pt;
            margin: 10px;
            transition: background-color 0.3s;
        }

        button:hover {
            background-color: #24576b; /* 호버 시 색상 변화 */
        }
        select{
            width: 45%;
            margin: 10px;
        }

        .more {
            background-color: #e0f7fa; /* 행 추가 버튼 색상 */
            color: gray;
            margin: 10px auto;
            padding: 10px 20px;
            cursor: pointer;
            border: none;
            border-radius: 5px;
            font-size: 10pt;
            color: black;
        }

        .more:hover {
            background-color: #b2ebf2; /* 호버 시 색상 변화 */
        }

        .input-area {
            text-align: center; /* 테이블 가운데 정렬 */
        }
        #data-table {
            width: 800px; 
            font-size: 10pt;           
            text-align: center;
            
        }
        #data-table td:nth-child(1) { /* 순번 */
            width: 8%;            
        }
        #data-table td:nth-child(2) { /* 구분 */
            width: 10%; 
        }
        #data-table td:nth-child(3) { /* 품목 */
            width: 19%; 
        }
        #data-table td:nth-child(4) { /* 수량 */
            width: 9%;
        }
        #data-table td:nth-child(5) { /* 단위 */
            width: 8%;
        }
        #data-table td:nth-child(6) { /* 단가 */
            width: 16%;
        }
        #data-table td:nth-child(7) { /* 금액 */
            width: 18%;
        }
        #data-table td:nth-child(8) { /* 비고 */
            width: 10%; 
        }
        #data-table th {
            text-align: center; /* 가운데 정렬 */
            border-right: 1px solid rgba(49, 112, 143, 0.5); /* 점선으로 변경 및 투명도 추가 */
            border-left: 1px solid rgba(49, 112, 143, 0.5)
        }

        #data-table td {
            padding: 0px;
            text-align: center; /* 가운데 정렬 */
            border: 1px solid #cfd8dc; /* 기본 테두리 색상 */
            border-bottom: 1px solid rgba(49, 112, 143, 0.5); /* 아래 테두리 투명도 추가 */
            border-top: 1px solid rgba(49, 112, 143, 0.5); /* 위 테두리 투명도 추가 */
            border-right: 1px dashed rgba(49, 112, 143, 0.5); /* 점선으로 변경 및 투명도 추가 */
            
        }

        /* 마지막 열의 오른쪽 테두리 제거 */
        #data-table td:last-child,
        #data-table th:last-child {
            border-right: none; /* 마지막 열의 오른쪽 테두리 제거 */
        }
        .date-picker {
        display: flex; /* Flexbox 사용 */
        align-items: center; /* 수직 정렬 */
        width: 30%;
        }

        .date-picker input {
            margin: 0 5px; /* 입력 필드 간의 여백 */
        }
    /* 이미지 미리보기 스타일 */
    .image-preview {
        display: flex;
        align-items: center;
        margin-top: 10px;
        justify-content: flex-start;
    }

    .image-preview img {
        width: 100px; /* 정해진 너비 */
        height: 100px; /* 정해진 높이 */
        object-fit: cover; /* 비율 유지하면서 크기 조절 */
        margin-right: 10px;
        border: 1px solid #cfd8dc;
        border-radius: 5px;
        cursor: pointer; /* 클릭 시 포인터 표시 추가 */
    }

    .delete-image {
        background-color: #f44336;
        color: white;
        border: none;
        border-radius: 5px;
        padding: 5px 8px;
        cursor: pointer;
    }

    .delete-image:hover {
        background-color: #d32f2f;
    }
    </style>
</head>
<body>
    <div class="form-container">
        <h2>행복나르미 신청하기</h2>
        <form id="activityForm">
            <table>
                <tr>
                    <th>신청자명</th>
                    <td><input type="text" name="Name" placeholder="이름을 입력하세요" required></td>
                </tr>
                <tr>
                    <th>이메일</th>
                    <td><input type="email" name="Email" placeholder="이메일을 입력하세요" required></td>
                </tr>
                <tr>
                    <th>활동지역</th>
                    <td style="display: flex; border: none;">
                        <select id="city" onchange="updateDistricts()">
                            <option value="">선택하세요</option>
                            <option value="천안">천안</option>
                            <option value="아산">아산</option>
                        </select>
                        <select id="district" required style="display: none;">
                            <option value="">선택하세요</option>
                        </select>
                    </td>
                </tr>
                <tr>
                    <th>기관명</th>
                    <td><input type="text" placeholder="기관명을 입력하세요" required></td>
                </tr>
                <tr>
                    <th>활동 제목</th>
                    <td><input type="text" placeholder="제목을 입력하세요" class="long" required></td>
                </tr>
                <tr>
                    <th>활동 기간설정</th>
                    <td>
                        <div class="date-picker">
                            <input type="date" name="startDate" required>
                            <span>~</span>
                            <input type="date" name="endDate" required>
                        </div>
                    </td>
                </tr>
                <tr>
                    <th>펀딩 마감일</th>
                    <td><input type="date" name="startDate" required style="width: 45%;display: flex;margin-left: 5px;"></td>
                </tr>
                <tr>
                    <th>펀딩목표금액</th>
                    <td><input type="text" maxlength="10" onkeyup="inputNumberFormat(this);" placeholder="금액을 입력하세요" required></td>
                </tr>
                <tr>
                    <th>자기소개</th>
                    <td><textarea maxlength="500" placeholder="500자 내로 간단히 입력해주세요" required></textarea></td>
                </tr>
                <tr>
                    <th>프로필 사진</th>
                    <td>
                        <input type="file" accept="image/*" onchange="previewImage(event, 'profilePreview')">
                        <div class="image-preview" id="profilePreview"></div>
                    </td>
                </tr>
                <tr>
                    <th>활동지역 사진</th>
                    <td>
                        <input type="file" accept="image/*" onchange="previewImage(event, 'locationPreview')">
                        <div class="image-preview" id="locationPreview"></div>
                    </td>
                </tr>
            </table>
        </form>
    </div>

    <div class="output-container">
        <h2>산출내역</h2>
        <div class="input-area">
            <table id="data-table">
                <tr>
                    <th>순번</th>
                    <th>구분</th>
                    <th>품목</th>
                    <th>수량</th>
                    <th>단위</th>
                    <th>단가</th>
                    <th>금액</th>
                    <th>비고</th>                                 
                </tr>
                <tr>
                    <td><input type="number" style="border:0;"></td>
                    <td><input type="text" style="border:0;"></td>
                    <td><input type="text" style="border:0;"></td>
                    <td><input type="number" style="border:0;"oninput="calculateAmount(this);"></td>
                    <td><input type="text" style="border:0;"></td>
                    <td><input type="number" style="border:0;"oninput="calculateAmount(this);"></td>
                    <td><input type="text" style="border:0;" readonly></td>
                    <td><input type="text" maxlength="10" style="border:0;"></td>
                </tr>
            </table>
            <button id="add-row" class="more">+ 행 추가</button>
        </div>
    </div>

    <div style="text-align: center;">
        <button type="submit" onclick="regist();" class="submit">신청하기</button>
        <button type="button" onclick="confirmCancel();" class="cancle" style="background-color: rgb(116, 194, 194);">취소하기</button>
    </div>

    <script>
        function updateDistricts() {
            const citySelect = document.getElementById("city");
            const districtSelect = document.getElementById("district");

            const districts = {
                "천안": ["선택하세요", "서북구","동남구"],
                "아산": ["선택하세요", "탕정면", "배방읍","음봉면"]
            };

            const selectedCity = citySelect.value;
            districtSelect.innerHTML = '';

            if (selectedCity in districts) {
            // 선택창 보이기
            districtSelect.style.display = 'inline'; 
            districts[selectedCity].forEach(function(district) {
                const option = document.createElement("option");
                option.value = district;
                option.textContent = district;
                districtSelect.appendChild(option);
            });
                } else {
            // 선택창 숨기기
            districtSelect.style.display = 'none'; 
            }
        }
        function comma(str) {
            str = String(str);
            return str.replace(/(\d)(?=(?:\d{3})+(?!\d))/g, '$1,');
        }

        function uncomma(str) {
            str = String(str);
            return str.replace(/[^\d]+/g, '');
        } 
        
        function inputNumberFormat(obj) {
            obj.value = comma(uncomma(obj.value));
        }

        document.getElementById('add-row').addEventListener('click', function(event) {
            event.preventDefault();

            const table = document.getElementById('data-table');
            const newRow = table.insertRow(); 

            const cell1 = newRow.insertCell(0); 
            const cell2 = newRow.insertCell(1); 
            const cell3 = newRow.insertCell(2); 
            const cell4 = newRow.insertCell(3); 
            const cell5 = newRow.insertCell(4); 
            const cell6 = newRow.insertCell(5); 
            const cell7 = newRow.insertCell(6); 
            const cell8 = newRow.insertCell(7); 

            cell1.innerHTML = '<input type="number" style="border:0;">';
            cell2.innerHTML = '<input type="text" style="border:0;">';
            cell3.innerHTML = '<input type="text" style="border:0;">';
            cell4.innerHTML = '<input type="number" style="border:0;">';
            cell5.innerHTML = '<input type="text" style="border:0;">';
            cell6.innerHTML = '<input type="number" style="border:0;">';
            cell7.innerHTML = '<input type="number" style="border:0;">';
            cell8.innerHTML = '<input type="text" maxlength="10" style="border:0;">';
            
            cell1.innerHTML = '<input type="number" style="border:0;" oninput="calculateAmount(this);">';
            cell2.innerHTML = '<input type="text" style="border:0;">';
            cell3.innerHTML = '<input type="text" style="border:0;">';
            cell4.innerHTML = '<input type="number" style="border:0;" oninput="calculateAmount(this);">';
            cell5.innerHTML = '<input type="text" style="border:0;">';
            cell6.innerHTML = '<input type="number" style="border:0;" oninput="calculateAmount(this);">';
            cell7.innerHTML = '<input type="text" style="border:0;" readonly>';
            cell8.innerHTML = '<input type="text" maxlength="10" style="border:0;">';
        });

        function regist() {
            if (confirm("제출하시겠습니까?") == true) {
                alert("제출되었습니다.");
                window.close();
            } else {
                return;
            }
        }
        function confirmCancel() {
            if (confirm("정말 취소하겠습니다?")) {
                window.close();
            }
        }

            function calculateAmount(input) {
        const row = input.closest('tr');

        // 수량과 단가 입력값 가져오기
        const quantityInput = row.cells[3].querySelector('input');
        const unitPriceInput = row.cells[5].querySelector('input');
        const amountInput = row.cells[6].querySelector('input');

        // 숫자로 변환 (쉼표 제거)
        const quantity = parseFloat(quantityInput.value.replace(/,/g, '')) || 0;
        const unitPrice = parseFloat(unitPriceInput.value.replace(/,/g, '')) || 0;

        // 계산
        const amount = quantity * unitPrice;

        // 금액이 유효한 경우에만 업데이트
        if (!isNaN(amount) && amount >= 0) {
            amountInput.value = amount.toLocaleString('ko-KR'); // 천 단위 쉼표 추가
        } else {
            amountInput.value = ""; // 숫자가 아닐 경우 빈 문자열로 초기화
        }
    }
    //이미지 미리보기 및 삭제 기능

    function previewImage(event, previewId) {
        const file = event.target.files[0];
        const previewContainer = document.getElementById(previewId);
        previewContainer.innerHTML = '';

        if (file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                const img = document.createElement('img');
                img.src = e.target.result;
                img.src = e.target.result;
                img.onclick = function() {
                const newWindow = window.open("", "_blank"); // 새 창 열기
                newWindow.document.write("<img src='" + img.src + "' style='max-width:100%; height:auto;'>"); // 이미지 삽입
};

                const deleteBtn = document.createElement('button');
                deleteBtn.textContent = '삭제';
                deleteBtn.className = 'delete-image';
                deleteBtn.onclick = function() {
                    event.target.value = ''; // 파일 입력 초기화
                    previewContainer.innerHTML = ''; // 미리보기 초기화
                };

                previewContainer.appendChild(img);
                previewContainer.appendChild(deleteBtn);
            }
            reader.readAsDataURL(file);
        }
    }
    </script>
</body>
</html>
